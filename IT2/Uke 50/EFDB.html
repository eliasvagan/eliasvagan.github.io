<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EFDB</title>
    <style>
        html {
            background-color: #eeeeee;
        }
        body {
            background-color: white;
            padding: 1em;
            font-family: sans-serif;
            max-width: 60em;
            margin: 1em auto;
            border: solid 0.2em lightgray;
        }
        table {
            width: 100%;
            /*border: solid 0.1em lightgray;*/

        }
        table td {
            padding: 3px;
        }
        table tr:hover {
            background-color: #c8f1ff;
        }
        h1 {
            font-size: 2em;
        }
        h1, h2 {
            text-align: center;
            color: rgba(67, 67, 67, 0.88);
        }
        .metascore {
            color: green;
            text-align: center;
        }
        .cost {
            color: blue;

        }
        button, input {
            width: 100%;
            padding: 0.5em;
            font-size: 1.2em;
        }
        input {
            width: calc(100%  - 1em);
        }
        div.flexRow {
            display: flex;
            flex-direction: row;
            width: 100%;
        }
        div.flexRow:first-child {
            flex: 2;
        }
        div.flexRow:last-child {
            flex: 1;
        }
        #artInfo {
            padding: 1em;
            flex: 1;
            border-left: solid 0.1em lightgray;
        }


    </style>
</head>
<body>
 <section id="middle">
     <h1>EMDB</h1>
     <h2>Elias' movie database</h2>




     <div class="flexRow">
         <div>
             <input type="text" id="inpSearch" placeholder="Search by title">
             <table>
                 <thead>
                 <tr>
                     <th><button id="btnTitle">Title</button></th>
                     <th><button id="btnDirector">Director</button></th>
                     <th><button id="btnMetascore">Metascore</button></th>
                     <th><button id="btnCost">Cost</button></th>
                 </tr>
                 </thead>
                 <tbody id="tblFilmer"></tbody>
             </table>
         </div>
         <div id="artInfo">
             <p><i>(Click on a movie to display info)</i></p>
         </div>

     </div>


 </section>


</body>


<script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyAVmb7h-qZtIN6EVAoTpnbn9RVHK4l4_YI",
        authDomain: "awesomeshit-d8966.firebaseapp.com",
        databaseURL: "https://awesomeshit-d8966.firebaseio.com",
        storageBucket: "awesomeshit-d8966.appspot.com",
        messagingSenderId: "55141776021"
    };
    firebase.initializeApp(config);

    let database = firebase.database();
    let filmer = database.ref("filmer");
    let tblFilmer = document.getElementById("tblFilmer");
    let btnTitle = document.getElementById("btnTitle");
    let btnDirector = document.getElementById("btnDirector");
    let btnMetascore = document.getElementById("btnMetascore");
    let btnCost = document.getElementById("btnCost");
    let inpSearch = document.getElementById("inpSearch");
    let artInfo = document.getElementById("artInfo");
    

    function visInfo(snapshot) {
        let data = snapshot.val();
        artInfo.innerHTML = `
            <img src="${data.Poster}">
            <h2>${data.Title}</h2>
            <p><b>Director:</b> ${data.Director}</p>
            <p><b>Actors:</b> ${data.Actors}</p>
            <p><b>Plot:</b> ${data.Plot}</p>
        `;
    }
    function finnFilm(id) {
        let film = database.ref("filmer/" + id);
        film.on("value", visInfo);
    }
    
    function visFilmer(snapshot) {
        let film = snapshot.val();
        let rad = `

            <tr onclick="finnFilm('${snapshot.key}')">
                <td>${film.Title}</td>
                <td>${film.Director}</td>
                <td class="metascore">${film.Metascore}</td>
                <td class="cost">$${film.Cost}M</td>

            </tr>

        `;
        tblFilmer.innerHTML = tblFilmer.innerHTML + rad;

    }

    filmer.on("child_added", visFilmer);

    btnTitle.addEventListener("click", function(){
        tblFilmer.innerHTML ="";
        filmer

            .orderByChild("Title")
            .on("child_added", visFilmer);
        visFilmer();
    });
    btnDirector.addEventListener("click", function(){
        tblFilmer.innerHTML ="";
        filmer

            .orderByChild("Director")
            .on("child_added", visFilmer);
        visFilmer();
    });
    btnMetascore.addEventListener("click", function(){
        tblFilmer.innerHTML ="";
        filmer

            .orderByChild("Metascore")
            .on("child_added", visFilmer);
        visFilmer();
    });
    btnCost.addEventListener("click", function(){
        tblFilmer.innerHTML ="";
        filmer

            .orderByChild("Cost")
            .on("child_added", visFilmer);
        visFilmer();
    });


    function finnFilmer() {
        tblFilmer.innerHTML = "";
        let tittel = this.value;
        filmer
                .orderByChild("Title")
                .startAt(tittel)
                .endAt(tittel + '\uf8ff')
                .on("child_added", visFilmer);
    }
    inpSearch.addEventListener("input", finnFilmer);


</script>
</html>